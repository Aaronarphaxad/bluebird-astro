---
// Contact Section - shared between homepage and contact page
// Two-column layout inspired by Bravio-style contact page
interface Props {
	id?: string;
}

const { id = 'contact' } = Astro.props;
---

<section
	id={id}
	class="relative bg-bg overflow-hidden px-4 sm:px-6 lg:px-8 py-16 sm:py-20 md:py-24"
	aria-labelledby="contact-heading"
>
	<div
		class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle,rgba(0,0,0,0.10)_1px,transparent_1px)] bg-[size:22px_22px] opacity-[0.11]"
		aria-hidden="true"
	></div>

	<div class="relative max-w-7xl mx-auto">
		<div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-start">
			<!-- Left column: copy + direct contact -->
			<div class="lg:col-span-6 space-y-10">
				<div class="space-y-3">
					<p class="text-xs text-textMuted mb-2">
						Contact us
					</p>
					<h2
						id="contact-heading"
						class="font-headline font-bold text-text leading-[0.9] tracking-[-0.04em] text-[clamp(2.8rem,6vw,4rem)]"
					>
						Let's collaborate
					</h2>
					<p class="text-sm sm:text-base md:text-lg text-textMuted max-w-xl leading-relaxed">
						Reach out and let’s explore how we can bring your ideas to life. Whether you’re ready to begin or just have
						questions, we’re here to help.
					</p>
				</div>

				<div class="space-y-8">
					<div class="space-y-1">
						<p class="text-xs font-medium uppercase tracking-[0.16em] text-textMuted">Call us</p>
						<a
							href="tel:+12368635191"
							class="block text-2xl sm:text-3xl font-semibold text-text hover:text-accent transition-colors"
						>
							(236) 863-5191
						</a>
					</div>

					<div class="space-y-1">
						<p class="text-xs font-medium uppercase tracking-[0.16em] text-textMuted">Email</p>
						<a
							href="mailto:hello@bluebirdweb.ca"
							class="block text-2xl sm:text-3xl font-semibold text-text hover:text-accent transition-colors break-all"
						>
						hello@bluebirdweb.ca
						</a>
						<p class="text-xs sm:text-sm text-textMuted mt-2">
							Reach out via email or give us a call—we’re happy to assist you.
						</p>
					</div>

					<div class="space-y-3">
						<p class="text-xs font-medium uppercase tracking-[0.16em] text-textMuted">Social</p>
						<ul class="space-y-1.5 text-sm sm:text-base">
							<li>
								<a
									href="#"
									class="inline-flex items-center gap-2 text-text hover:text-accent transition-colors"
								>
									<span aria-hidden="true" class="text-xs">↗</span>
									Facebook
								</a>
							</li>
							<li>
								<a
									href="#"
									class="inline-flex items-center gap-2 text-text hover:text-accent transition-colors"
								>
									<span aria-hidden="true" class="text-xs">↗</span>
									Instagram
								</a>
							</li>
							<li>
								<a
									href="#"
									class="inline-flex items-center gap-2 text-text hover:text-accent transition-colors"
								>
									<span aria-hidden="true" class="text-xs">↗</span>
									LinkedIn
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<!-- Right column: form -->
			<div class="lg:col-span-6">
				<div class="bg-white/80 backdrop-blur-md border border-black/5 shadow-[0_18px_45px_rgba(15,23,42,0.10)] rounded-[32px] p-5 sm:p-7 md:p-8">
					<form
						class="space-y-5"
						method="POST"
						aria-label="Project inquiry form"
					>
						<!-- basic anti-spam: honeypot + min submit time -->
						<input type="text" name="company_website" tabindex="-1" autocomplete="off" class="hidden" aria-hidden="true" />
						<input type="hidden" name="form_started_at" id="form-started-at" value="" />

						<!-- Name (one row) -->
						<div class="space-y-1.5">
							<label for="contact-name" class="text-xs font-medium text-textMuted">Name</label>
							<input
								id="contact-name"
								name="name"
								type="text"
								autocomplete="name"
								required
								class="w-full rounded-full border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition"
								placeholder="Jane Doe"
							/>
						</div>

						<!-- Email + phone (one row) -->
						<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
							<div class="space-y-1.5">
								<label for="contact-email" class="text-xs font-medium text-textMuted">* Email</label>
								<input
									id="contact-email"
									name="email"
									type="email"
									autocomplete="email"
									required
									class="w-full rounded-full border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition"
									placeholder="you@company.com"
								/>
							</div>

							<div class="space-y-1.5">
								<label for="contact-phone" class="text-xs font-medium text-textMuted">Phone (optional)</label>
								<input
									id="contact-phone"
									name="phone"
									type="tel"
									autocomplete="tel"
									class="w-full rounded-full border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition"
									placeholder="+1 (555) 123-4567"
								/>
							</div>
						</div>

						<!-- Service checkboxes (one row) -->
						<div class="space-y-1.5">
							<fieldset class="space-y-2" aria-describedby="contact-service-hint">
								<legend class="text-xs font-medium text-textMuted">* Service required</legend>

								<div class="flex flex-wrap justify-center gap-2">
									<label class="service-tab-button relative px-3 sm:px-4 py-2 text-xs font-medium rounded-full transition-all duration-300 text-textMuted bg-accentSubtle/50 hover:bg-accentSubtle cursor-pointer">
										<input
											type="checkbox"
											name="service[]"
											value="website"
											class="absolute opacity-0 w-0 h-0 pointer-events-none"
											required
										/>
										<span>Website</span>
									</label>
									<label class="service-tab-button relative px-3 sm:px-4 py-2 text-xs font-medium rounded-full transition-all duration-300 text-textMuted bg-accentSubtle/50 hover:bg-accentSubtle cursor-pointer">
										<input type="checkbox" name="service[]" value="custom-software" class="absolute opacity-0 w-0 h-0 pointer-events-none" />
										<span>Custom software</span>
									</label>
									<label class="service-tab-button relative px-3 sm:px-4 py-2 text-xs font-medium rounded-full transition-all duration-300 text-textMuted bg-accentSubtle/50 hover:bg-accentSubtle cursor-pointer">
										<input type="checkbox" name="service[]" value="brand-design" class="absolute opacity-0 w-0 h-0 pointer-events-none" />
										<span>Brand design</span>
									</label>
									<label class="service-tab-button relative px-3 sm:px-4 py-2 text-xs font-medium rounded-full transition-all duration-300 text-textMuted bg-accentSubtle/50 hover:bg-accentSubtle cursor-pointer">
										<input type="checkbox" name="service[]" value="improved-operations" class="absolute opacity-0 w-0 h-0 pointer-events-none" />
										<span>Automation</span>
									</label>
								</div>

								<p id="contact-service-hint" class="text-xs text-textMuted">
									Select one or more.
								</p>
							</fieldset>
						</div>

						<div class="space-y-1.5">
							<label
								for="contact-message"
								class="text-xs font-medium text-textMuted"
							>
								Project description / message (optional)
							</label>
							<textarea
								id="contact-message"
								name="message"
								rows="4"
								class="w-full rounded-3xl border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition resize-none"
								placeholder="Share a bit about your project, goals, and timeline."
							></textarea>
						</div>


						<div class="space-y-2">
							<label class="flex items-start gap-3 rounded-2xl border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text shadow-[0_1px_0_rgba(15,23,42,0.03)]">
								<input
									id="privacy-consent"
									name="privacy_consent"
									type="checkbox"
									required
									class="mt-0.5 accent-accent"
								/>
								<span class="text-textMuted">
									I agree to the <a href="/privacy" class="text-text underline underline-offset-2 hover:text-accent">Privacy Policy</a>.
								</span>
							</label>
							<p class="text-xs text-textMuted">
								By submitting, you consent to us contacting you about your inquiry.
							</p>
						</div>

						<div class="pt-2 flex flex-col items-center">
							<button
								type="submit"
								id="contact-submit"
								class="inline-flex items-center justify-center gap-2 rounded-full bg-accent px-6 py-3 text-sm font-medium text-white shadow-[0_14px_30px_rgba(0,0,0,0.3)] hover:bg-black hover:translate-y-[-1px] hover:shadow-[0_18px_40px_rgba(0,0,0,0.35)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-white transition-all disabled:opacity-40 disabled:hover:bg-accent disabled:hover:translate-y-0 disabled:hover:shadow-[0_14px_30px_rgba(0,0,0,0.3)]"
							>
								<span>Send message</span>
								<svg
									class="h-4 w-4"
									viewBox="0 0 24 24"
									fill="none"
									xmlns="http://www.w3.org/2000/svg"
									aria-hidden="true"
								>
									<path
										d="M5 12H19M19 12L13 6M19 12L13 18"
										stroke="currentColor"
										stroke-width="1.8"
										stroke-linecap="round"
										stroke-linejoin="round"
									/>
								</svg>
							</button>
							<p class="mt-3 text-xs text-textMuted text-center">
								We typically respond within 1–2 business days.
							</p>
						</div>
					</form>
				</div>

				<script is:inline>
					(() => {
						const form = document.querySelector('form[aria-label="Project inquiry form"]');
						if (!form) return;

						const startedAt = form.querySelector('#form-started-at');
						const consent = form.querySelector('#privacy-consent');
						const submitBtn = form.querySelector('#contact-submit');
						const honeypot = form.querySelector('input[name="company_website"]');
						const nameInput = form.querySelector('input[name="name"]');
						const emailInput = form.querySelector('input[name="email"]');
						const serviceCheckboxes = Array.from(form.querySelectorAll('input[name="service[]"]'));

						const now = Date.now();
						if (startedAt) startedAt.value = String(now);

						const hasSelectedService = () => {
							return serviceCheckboxes.some((c) => c.checked);
						};

						const syncServiceRequired = () => {
							// Native "required" doesn't work as a group, so toggle required on the first checkbox.
							if (serviceCheckboxes.length === 0) return;
							serviceCheckboxes[0].required = !hasSelectedService();
						};

						const hasRequiredText = () => {
							const nameOk = !!(nameInput && nameInput.value.trim().length > 0);
							const emailOk = !!(emailInput && emailInput.value.trim().length > 0);
							return nameOk && emailOk;
						};

						const updateServiceTabStyles = () => {
							serviceCheckboxes.forEach((checkbox) => {
								const label = checkbox.closest('label.service-tab-button');
								if (!label) return;
								
								if (checkbox.checked) {
									label.classList.add('active', 'bg-text', 'text-bg');
									label.classList.remove('text-textMuted', 'bg-accentSubtle/50');
								} else {
									label.classList.remove('active', 'bg-text', 'text-bg');
									label.classList.add('text-textMuted', 'bg-accentSubtle/50');
								}
							});
						};

						const sync = () => {
							if (!submitBtn || !consent) return;
							syncServiceRequired();
							updateServiceTabStyles();
							submitBtn.disabled = !(consent.checked && hasRequiredText() && hasSelectedService());
						};
						sync();
						consent?.addEventListener('change', sync);
						nameInput?.addEventListener('input', sync);
						emailInput?.addEventListener('input', sync);
						serviceCheckboxes.forEach((c) => {
							c.addEventListener('change', sync);
						});

						form.addEventListener('submit', (e) => {
							try {
								// Honeypot filled -> likely bot
								if (honeypot && honeypot.value && honeypot.value.trim().length > 0) {
									e.preventDefault();
									return;
								}

								// Guard: don't submit until required fields are actually ready
								if (!(consent?.checked && hasRequiredText() && hasSelectedService())) {
									e.preventDefault();
									return;
								}

								// Too fast -> likely bot (3s)
								const started = startedAt?.value ? Number(startedAt.value) : now;
								if (!Number.isNaN(started) && Date.now() - started < 3000) {
									e.preventDefault();
									return;
								}
							} catch {
								// If anything goes wrong, don't block legitimate users
							}
						});
					})();
				</script>

				<div class="mt-8 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
					
					<div class="text-xs sm:text-sm text-textMuted mx-auto">
						<span class="font-medium text-text">Address</span>
						<span class="mx-1">·</span>
						<span>13963 105 Blvd, Surrey, BC V3T 0M9</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
