---
// Contact Section - shared between homepage and contact page
// Two-column layout inspired by Bravio-style contact page
interface Props {
	id?: string;
}

const { id = 'contact' } = Astro.props;

const formId = import.meta.env.PUBLIC_FORMSPARK_FORM_ID ?? '';
const formActionUrl = formId ? `https://submit-form.com/${formId}` : '';
---

<section
	id={id}
	class="relative bg-bg overflow-hidden px-4 sm:px-6 lg:px-8 py-16 sm:py-20 md:py-24"
	aria-labelledby="contact-heading"
>
	<div
		class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle,rgba(0,0,0,0.10)_1px,transparent_1px)] bg-[size:22px_22px] opacity-[0.11]"
		aria-hidden="true"
	></div>

	<div class="relative max-w-7xl mx-auto">
		<div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-start">
			<!-- Left column: copy + direct contact -->
			<div class="lg:col-span-6 space-y-10">
				<div class="space-y-3">
					<p class="text-xs text-textMuted mb-2">
						Contact us
					</p>
					<h2
						id="contact-heading"
						class="font-headline font-bold text-text leading-[0.9] tracking-[-0.04em] text-[clamp(2.8rem,6vw,4rem)]"
					>
						Let's collaborate
					</h2>
					<p class="text-sm sm:text-base md:text-lg text-textMuted max-w-xl leading-relaxed">
						Reach out and let’s explore how we can bring your ideas to life. Whether you’re ready to begin or just have
						questions, we’re here to help.
					</p>
				</div>

				<div class="space-y-8">
					<div class="space-y-1">
						<p class="text-xs font-medium uppercase tracking-[0.16em] text-textMuted">Call us</p>
						<a
							href="tel:+12368635191"
							class="block text-2xl sm:text-3xl font-semibold text-text hover:text-accent transition-colors"
						>
							(236) 863-5191
						</a>
					</div>

					<div class="space-y-1">
						<p class="text-xs font-medium uppercase tracking-[0.16em] text-textMuted">Email</p>
						<a
							href="mailto:hello@bluebirdweb.ca"
							class="block text-2xl sm:text-3xl font-semibold text-text hover:text-accent transition-colors break-all"
						>
						hello@bluebirdweb.ca
						</a>
						<p class="text-xs sm:text-sm text-textMuted mt-2">
							Reach out via email or give us a call—we’re happy to assist you.
						</p>
					</div>

					<div class="space-y-3">
						<p class="text-xs font-medium uppercase tracking-[0.16em] text-textMuted">Social</p>
						<ul class="space-y-1.5 text-sm sm:text-base">
							<li>
								<a
									href="https://x.com/bluebird_web"
									class="inline-flex items-center gap-2 text-text hover:text-accent transition-colors"
								>
									<span aria-hidden="true" class="text-xs">↗</span>
									X
								</a>
							</li>
							<li>
								<a
									href="#"
									class="inline-flex items-center gap-2 text-text hover:text-accent transition-colors"
								>
									<span aria-hidden="true" class="text-xs">↗</span>
									Instagram
								</a>
							</li>
							<li>
								<a
									href="#"
									class="inline-flex items-center gap-2 text-text hover:text-accent transition-colors"
								>
									<span aria-hidden="true" class="text-xs">↗</span>
									LinkedIn
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<!-- Right column: form -->
			<div class="lg:col-span-6">
				<div class="bg-white/80 backdrop-blur-md border border-black/5 shadow-[0_18px_45px_rgba(15,23,42,0.10)] rounded-[32px] p-5 sm:p-7 md:p-8">
					<form
						id="contact-form"
						class="space-y-5"
						method="POST"
						action={formActionUrl}
						aria-label="Project inquiry form"
						data-formspark-url={formActionUrl}
					>
						<!-- basic anti-spam: honeypot + min submit time -->
						<input type="text" name="company_website" tabindex="-1" autocomplete="off" class="hidden" aria-hidden="true" />
						<input type="hidden" name="form_started_at" id="form-started-at" value="" />
						<!-- Name (one row) -->
						<div class="space-y-1.5">
							<label for="contact-name" class="text-xs font-medium text-textMuted">Name</label>
							<input
								id="contact-name"
								name="name"
								type="text"
								autocomplete="name"
								required
								class="w-full rounded-full border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition"
								placeholder="Jane Doe"
							/>
						</div>

						<!-- Email + phone (one row) -->
						<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
							<div class="space-y-1.5">
								<label for="contact-email" class="text-xs font-medium text-textMuted">* Email</label>
								<input
									id="contact-email"
									name="email"
									type="email"
									autocomplete="email"
									required
									class="w-full rounded-full border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition"
									placeholder="you@company.com"
								/>
							</div>

							<div class="space-y-1.5">
								<label for="contact-phone" class="text-xs font-medium text-textMuted">Phone (optional)</label>
								<input
									id="contact-phone"
									name="phone"
									type="tel"
									autocomplete="tel"
									class="w-full rounded-full border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition"
									placeholder="+1 (555) 123-4567"
								/>
							</div>
						</div>

						<!-- Service checkboxes (simple list) -->
						<div class="space-y-1.5">
							<fieldset class="space-y-2" aria-describedby="contact-service-hint">
								<legend class="text-xs font-medium text-textMuted">* Service required</legend>
								<div class="flex flex-wrap gap-x-6 gap-y-1">
									<label class="inline-flex items-center gap-2 text-sm text-text cursor-pointer">
										<input type="checkbox" name="service[]" value="website" class="accent-accent rounded border-[#E1E4EA]" />
										<span>Website</span>
									</label>
									<label class="inline-flex items-center gap-2 text-sm text-text cursor-pointer">
										<input type="checkbox" name="service[]" value="custom-software" class="accent-accent rounded border-[#E1E4EA]" />
										<span>Custom software</span>
									</label>
									<label class="inline-flex items-center gap-2 text-sm text-text cursor-pointer">
										<input type="checkbox" name="service[]" value="brand-design" class="accent-accent rounded border-[#E1E4EA]" />
										<span>Brand design</span>
									</label>
									<label class="inline-flex items-center gap-2 text-sm text-text cursor-pointer">
										<input type="checkbox" name="service[]" value="improved-operations" class="accent-accent rounded border-[#E1E4EA]" />
										<span>Automation</span>
									</label>
								</div>
								<p id="contact-service-hint" class="text-xs text-textMuted">Select one or more.</p>
							</fieldset>
						</div>

						<div class="space-y-1.5">
							<label
								for="contact-message"
								class="text-xs font-medium text-textMuted"
							>
								Project description / message (optional)
							</label>
							<textarea
								id="contact-message"
								name="message"
								rows="4"
								class="w-full rounded-3xl border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text placeholder:text-textMuted/60 shadow-[0_1px_0_rgba(15,23,42,0.03)] focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition resize-none"
								placeholder="Share a bit about your project, goals, and timeline."
							></textarea>
						</div>


						<div class="space-y-2">
							<label class="flex items-start gap-3 rounded-2xl border border-[#E1E4EA] bg-white px-4 py-3 text-sm text-text shadow-[0_1px_0_rgba(15,23,42,0.03)]">
								<input
									id="privacy-consent"
									name="privacy_consent"
									type="checkbox"
									required
									class="mt-0.5 accent-accent"
								/>
								<span class="text-textMuted">
									I agree to the <a href="/privacy" class="text-text underline underline-offset-2 hover:text-accent">Privacy Policy</a>.
								</span>
							</label>
							<p class="text-xs text-textMuted">
								By submitting, you consent to us contacting you about your inquiry.
							</p>
						</div>

						<div class="pt-2 flex flex-col items-center gap-3">
							<div id="form-success-message" class="hidden w-full max-w-md rounded-2xl bg-accentSubtle/60 border border-accent/20 px-4 py-3 text-sm text-text text-center" role="alert">
								Thanks for your message. We’ll be in touch soon.
							</div>
							<div id="form-error-message" class="hidden w-full max-w-md rounded-2xl bg-red-50 border border-red-200 px-4 py-3 text-sm text-red-800 text-center" role="alert">
								Something went wrong sending your message. Please try again or email us at <a href="mailto:hello@bluebirdweb.ca" class="underline font-medium">hello@bluebirdweb.ca</a>.
							</div>
							<button
								type="submit"
								id="contact-submit"
								class="inline-flex items-center justify-center gap-2 rounded-full bg-accent px-6 py-3 text-sm font-medium text-white shadow-[0_14px_30px_rgba(0,0,0,0.3)] hover:bg-black hover:translate-y-[-1px] hover:shadow-[0_18px_40px_rgba(0,0,0,0.35)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-white transition-all disabled:opacity-40 disabled:hover:bg-accent disabled:hover:translate-y-0 disabled:hover:shadow-[0_14px_30px_rgba(0,0,0,0.3)]"
							>
								<span>Send message</span>
								<svg
									class="h-4 w-4"
									viewBox="0 0 24 24"
									fill="none"
									xmlns="http://www.w3.org/2000/svg"
									aria-hidden="true"
								>
									<path
										d="M5 12H19M19 12L13 6M19 12L13 18"
										stroke="currentColor"
										stroke-width="1.8"
										stroke-linecap="round"
										stroke-linejoin="round"
									/>
								</svg>
							</button>
							<p class="mt-3 text-xs text-textMuted text-center">
								We typically respond within 1–2 business days.
							</p>
						</div>
					</form>
				</div>

				<script is:inline>
					(() => {
						const form = document.getElementById('contact-form');
						if (!form) return;

						const successEl = document.getElementById('form-success-message');
						const errorEl = document.getElementById('form-error-message');
						const startedAt = form.querySelector('#form-started-at');
						const consent = form.querySelector('#privacy-consent');
						const submitBtn = form.querySelector('#contact-submit');
						const honeypot = form.querySelector('input[name="company_website"]');
						const nameInput = form.querySelector('input[name="name"]');
						const emailInput = form.querySelector('input[name="email"]');
						const serviceCheckboxes = Array.from(form.querySelectorAll('input[name="service[]"]'));

						const now = Date.now();
						if (startedAt) startedAt.value = String(now);

						const formActionUrl = form.dataset.formsparkUrl;
						const hasSelectedService = () => serviceCheckboxes.some((c) => c.checked);
						const syncServiceRequired = () => {
							if (serviceCheckboxes.length) serviceCheckboxes[0].required = !hasSelectedService();
						};
						const hasRequiredText = () => {
							return !!(nameInput?.value?.trim()) && !!(emailInput?.value?.trim());
						};
						const sync = () => {
							if (!submitBtn || !consent) return;
							syncServiceRequired();
							submitBtn.disabled = !(consent.checked && hasRequiredText() && hasSelectedService());
						};

						sync();
						consent?.addEventListener('change', sync);
						nameInput?.addEventListener('input', sync);
						emailInput?.addEventListener('input', sync);
						serviceCheckboxes.forEach((c) => c.addEventListener('change', sync));

						form.addEventListener('submit', async (e) => {
							e.preventDefault();
							if (successEl) successEl.classList.add('hidden');
							if (errorEl) errorEl.classList.add('hidden');
							try {
								if (honeypot?.value?.trim()) return;
								if (!(consent?.checked && hasRequiredText() && hasSelectedService())) return;
								const started = startedAt?.value ? Number(startedAt.value) : now;
								if (!Number.isNaN(started) && Date.now() - started < 3000) return;
								if (!formActionUrl) return;

								submitBtn.disabled = true;
								// Formspark AJAX: JSON body + Accept/Content-Type application/json so they return 200 (no redirect/CORS)
								const service = serviceCheckboxes.filter((c) => c.checked).map((c) => c.value);
								const payload = {
									name: nameInput?.value?.trim() ?? '',
									email: emailInput?.value?.trim() ?? '',
									phone: form.querySelector('input[name="phone"]')?.value?.trim() ?? '',
									service: service.length ? service : undefined,
									message: form.querySelector('[name="message"]')?.value?.trim() ?? '',
								};
								const res = await fetch(formActionUrl, {
									method: 'POST',
									headers: { 'Content-Type': 'application/json', Accept: 'application/json' },
									body: JSON.stringify(payload),
								});
								if (!res.ok) throw new Error('Submit failed');
								if (successEl) {
									successEl.classList.remove('hidden');
									successEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
								}
								form.reset();
								if (startedAt) startedAt.value = String(Date.now());
								sync();
							} catch {
								if (errorEl) {
									errorEl.classList.remove('hidden');
									errorEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
								}
								submitBtn.disabled = false;
								sync();
							}
						});
					})();
				</script>

				<div class="mt-8 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
					
					<div class="text-xs sm:text-sm text-textMuted mx-auto">
						<span class="font-medium text-text">Address</span>
						<span class="mx-1">·</span>
						<span>13963 105 Blvd, Surrey, BC V3T 0M9</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
